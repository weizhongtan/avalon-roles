<!doctype html>
<html>
<head>
  <title>Avalon Setup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <link rel="stylesheet" href="css/style.css" type="text/css" />
</head>
<body>
  <div class="container">
    <p>Game setup? <span id="setup">No</span></p>
    <div id="remove">
      <form id="form">
        <select id="num-of-players">
          <option id="default" value="0" selected="selected">Select Number Of Players</option>
          <option value="3">3</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
        <div id="characters"></div>
        <select id="random">
          <option id="default" value="none" selected="selected">Select game type</option>
          <option value="true">Randomised characters</option>
          <option value="false">Characters already chosen</option>
        </select>
        <button id="create-game">Create Game</button>
      </form>
      <button id="stop-game">Stop Game</button>
      <button id="randomize" class="hide">Randomize Characters</button>
    </div>
  </div>
  <template>
    <select class="character">
      <option id="default" value="SelectCharacter" selected="selected">Select Character</option>
      <option value="GoodGuy">Loyal Servant of Arthur</option>
      <option value="Merlin">Merlin</option>
      <option value="Percival">Percival</option>
      <option value="BadGuy">Minion of Mordred</option>
      <option value="Assassin">Assassin</option>
      <option value="Morgana">Morgana</option>
      <option value="Mordred">Mordred</option>
      <option value="Oberon">Oberon</option>
    </select>
  </template>

  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js" type="text/javascript"></script>
  <script src="js/setup.js" type="text/javascript"></script>
  <script>
  $("#form").submit(function() {
    var num = $("#num-of-players").val();
    var random = $("#random").val();
    if (num > 0 && random !== "none") {
      var data = {
        random: random,
        numberOfPlayers: num,
        characters: []
      };
      data.characters = $(".character").map(function(e) {
        return $(this).val();
      }).toArray();
      socket.emit("newgame", data);
      if (random === "true") {
        $("#randomize").removeClass("hide");
      } else {
        $("#randomize").addClass("hide");
      }
      return false;
    }
  });
  $("#num-of-players").change(function() {
    var num = Number($("#num-of-players").val());
    console.log(num);
    $("#characters").html("");
    for (var i = 0; i < num; i++) {
      $("#characters").append($("template").html());
    }
  })
  $("#stop-game").click(function() {
    socket.emit("stopgame", {});
    $("#randomize").addClass("hide");
  })
  $("#randomize").click(function() {
    socket.emit("randomize", {});
    $("#randomize").addClass("hide");
  })
  </script>
</body>
</html>
